<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Product Listing Page</title><link rel="stylesheet" type="text/css" href="/fx-demos/static/css/style.css"><link rel="stylesheet" type="text/css" href="/fx-demos/static/css/site.css"><link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.css" rel="stylesheet"><link rel="icon" type="image/x-icon" href="/favicon.ico"><script src="/fx-demos/static/js/site.js"></script><script src="https://unpkg.com/@optimizely/optimizely-sdk@5.0.0-beta2/dist/optimizely.browser.umd.min.js"></script></head><body><div x-data="{ userDetails: $store.user}"><div :class="userDetails.mobileUser === true ? 'smartphone' : ''"><div class="content"><div class="frame"><div class="framedContent" x-data="$store.sdkReady"><header class="sticky top-0"><nav class="sticky top-0 bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a href="/" class="flex items-center"><img src="/static/img/mosey-logo.svg" :class="userDetails.mobileUser === true ? 'mr-3 h-6' : 'mr-3 h-6 sm:h-9'" alt="Flowbite Logo"> <span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white"></span></a><div x-data="$store.user" :class="userDetails.mobileUser === true ? 'flex items-center order-2' : 'flex items-center lg:order-2'"><div><span x-data="{userModal: false}"><div x-show="userModal" id="userModalWindow" class="app-modal fixed inset-0 flex items-center justify-center bg-gray-700 bg-opacity-50" tabindex="-1"><div class="relative w-full h-full max-w-md md:h-auto"><div class="relative bg-white rounded-lg shadow dark:bg-gray-700"><button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"><svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> <span class="sr-only">Close modal</span></button><div @click.away="userModal = false" class="px-6 py-6 lg:px-8"><h3 class="mb-4 text-xl font-medium text-gray-900 dark:text-white">User Attributes</h3><div class="space-y-6"><div x-data="{ user: $store.user}"><div class="md:flex md:items-center mb-3"><div x-init="$watch('user.mobileUser', (val) => user.updateLocalStorage('is_mobile_user', val))"><label class="relative inline-flex items-center cursor-pointer"><input x-model="user.mobileUser" class="sr-only peer" type="checkbox" x-bind:checked="user.mobileUser === true" name="mobileUserId" id="mobileUserId"><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div><span class="ml-3 text-sm font-medium text-gray-900 dark:text-gray-300">Mobile App User</span></label></div></div><div id="flagUserSection"></div><div class="pb-5" x-init="$watch('user.regionState', (val) => user.updateLocalStorage('region_state', val))"><label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">State</label> <input x-model="user.regionState" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" type="text" name="regionStateId" id="regionStateId"></div><div id="userIdSection"></div></div></div></div></div></div></div><button type="button" @click="userModal = !userModal" id="userButton" class="text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-full text-sm px-5 py-2.5 text-center mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Settings</button></span> <span x-data="{detailsModal: false}"><script>updateEmail = function(userAccount, val) {
        userAccount.updateLocalStorage('email', val);

        // Send event to ODP
        zaius.customer({ // First object contains any known customer identifiers
            email: val
        },{ // Second object contains customer attributes
            
        });

        zaius.event("customer", {
            action: "login",
            email:val, 
        });
    }</script><div x-show="detailsModal" id="detailsModalWindow" tabindex="-1" class="app-modal fixed inset-0 flex items-center justify-center bg-gray-700 bg-opacity-50"><div @click.away="detailsModal = false" class="relative w-full h-full max-w-md md:h-auto"><div class="elative bg-white rounded-lg shadow dark:bg-gray-700"><button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"><svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> <span class="sr-only">Close modal</span></button><div @click.away="detailsModal = false" class="px-6 py-6 lg:px-8"><h3 class="mb-4 text-xl font-medium text-gray-900 dark:text-white">Account Settings</h3><div class="space-y-6"><div x-data="{ sdk: $store.optiSdk }"><div class="md:flex md:items-center mb-6"><div class="md:w-1/3"><label class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4" for="inline-sdk-key">SDK Key</label></div><div class="md:w-2/3" x-init="$watch('sdk.key', (val) => sdk.fetchSdk(val))"><input x-model.debounce.2000="sdk.key" class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500" id="inline-sdk-key" type="text" placeholder="Enter your SDK Key" name="sdkKey" id="sdkKey"></div></div><div class="md:flex md:items-center mb-6"><div class="md:w-1/3"></div><label class="md:w-2/3 block text-gray-500 font-bold"><span id="sdkStatus" x-text="sdk.message" x-bind:class="sdk.isError ? 'text-sm text-red-500' : 'text-sm text-green-500'"></span></label></div><div class="md:flex md:items-center"><div class="md:w-1/3"></div><div class="md:w-2/3"><button class="shadow bg-purple-500 hover:bg-purple-400 focus:shadow-outline focus:outline-none text-white font-bold py-2 px-4 rounded" type="button">Update Key</button></div></div></div><div x-data="{ userAccount: $store.user }"><form class="w-full max-w-sm"><div class="flex items-center border-b border-teal-500 py-2"><input class="appearance-none bg-transparent border-none w-full text-gray-700 mr-3 py-1 px-2 leading-tight focus:outline-none" x-model="userAccount.email" type="text" placeholder="Email" aria-label="Email Address" id="emailId"> <button class="flex-shrink-0 bg-purple-500 hover:bg-purple-400 border-purple-500 hover:border-purple-700 text-sm border-4 text-white py-1 px-2 rounded" type="button" x-on:click="updateEmail(userAccount, emailId.value)">Update</button></div></form></div></div></div></div></div></div><button type="button" @click="detailsModal = !detailsModal" id="detailsButton" class="py-2.5 px-5 mr-2 mb-2 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-full border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">Details</button></span><template x-teleport="#userIdSection"><div><div x-init="$watch('uid', (val) => updateUId(val))"><div class="flex"><div class="w-1/2"><label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">User ID</label></div><div class="w-1/2 justify-end text-right"><a href="#" x-on:click.prevent="uid = crypto.randomUUID()" class="text-sm text-blue-700 hover:underline dark:text-blue-500">Randomize</a></div></div><input class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" type="text" id="userId" readonly="readonly" x-model="uid"></div></div></template></div><button data-collapse-toggle="mobile-menu-2" type="button" :class="userDetails.mobileUser === true ? 'inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600' : 'inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600'" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span> <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg> <svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div :class="userDetails.mobileUser === true ? 'hidden justify-between items-center w-full flex w-auto order-1' : 'hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1'" id="mobile-menu-2"><div class="flex-1"><div x-cloak><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a href="/credit-cards" class="block py-2 pr-4 pl-3 text-black rounded bg-primary-700 lg:bg-transparent lg:text-primary-700 lg:p-0 dark:text-white" aria-current="page">Credit Cards</a></li><li><a href="/plp" class="block py-2 pr-4 pl-3 text-black rounded bg-primary-700 lg:bg-transparent lg:text-primary-700 lg:p-0 dark:text-white" aria-current="page">PLP</a></li><li><a href="/pdp" class="block py-2 pr-4 pl-3 text-black rounded bg-primary-700 lg:bg-transparent lg:text-primary-700 lg:p-0 dark:text-white" aria-current="page">PDP</a></li><li><a href="/subscriptions" class="block py-2 pr-4 pl-3 text-black rounded bg-primary-700 lg:bg-transparent lg:text-primary-700 lg:p-0 dark:text-white" aria-current="page">Subscriptions</a></li><li><a href="/leadform" class="block py-2 pr-4 pl-3 text-black rounded bg-primary-700 lg:bg-transparent lg:text-primary-700 lg:p-0 dark:text-white" aria-current="page">Lead Form</a></li></ul></div></div></div></div></nav></header><div class="bg-blue-100 border-t border-b border-blue-500 text-blue-700 px-4 py-3" role="alert"><p class="text-sm">Viewing experience as <strong><code x-text="userDetails.uid"></code></strong></p></div><div id="informational-banner" tabindex="-1" x-cloak x-show="!isLoaded" class="fixed left-0 z-50 flex flex-col justify-between w-full p-4 border-b border-gray-200 md:flex-row bg-red-600 dark:border-gray-600"><div class="mb-4 md:mb-0 md:mr-4"><h2 class="mb-1 text-base font-semibold text-white">In order to interact with Feature experimentation enter your SDK key by selecting Details on the top right.</h2></div></div><script>var _products = null;

  function intializeAttributes(user) {
    initializeUserAttribute(user, 'daysSinceLastOrder', '0', localStorage.getItem('days_since_last_order'));
  }

  function sortProducts(products, sortBy, locationInputForVariable, location) {
    if (locationInputForVariable == true && location === 'CA') {
        sortBy = 'price_descending';
    }
    else if (locationInputForVariable == true) {
        sortBy = 'price_ascending';
    }

    return products.sort((a, b) => {
        switch (sortBy) {
            case "price_descending":
                if (a.price > b.price) {
                    return -1;
                };
                break;
            case "price_ascending":
                console.log('Changing sort order');
                if (b.price > a.price){
                    return -1;
                }
                break;
            case "top_sellers":
                if (a.top_seller > b.top_seller) {
                    return -1;
                }
                break;
            case "new_products": 
                if (a.new_product > b.new_product) {
                    return -1;
                }
                break;
            default: 
                if (a.title > b.title) {
                    return -1;
                }
                break;
        }
    });
  }

  function getProducts(userData) {
    var sortField = userData.sortField;
    var locationInputForVariable = userData.locationInputForVariable;
    var location = userData.regionState;

    var startTime = new Date();

    switch (userData.productSource) {
        case "graphql":
            break;
        default:
        fetch("/static/data/products.json")
            .then(response => response.json())
            .then((json) => {
                userData.products = sortProducts(json, sortField, locationInputForVariable, location);
            });
        break;
    }

    var endTime = new Date();
  }

  function getPlpFlag(
    clientVersion,  
    userData,
    flagKey) {
        userData.locationInputForVariable = false;
        if (userData == null) {
            return false;
        }

        if (flagKey === '') {
            return false;
        }
        
        var ua = getUserAttributes(userData);
        var uc = getUserContext(userData, ua);

        if (uc == null) {
            return false;
        }

        /*const syncFunction = () => {
        const fetched = uc.fetchQualifiedSegments()
        console.log(fetched) // Promise (Pending)
        fetched.then(result => {
            console.log(result) // true
            console.log(uc.qualifiedSegments) // Updated qualified segments for target user
        })
        };*/

        var decision = uc.decide(flagKey);

        if (decision != null && decision.enabled) {
            userData.sortField = decision.variables["sort_field"];
            userData.productSource = decision.variables["product_source"];
            userData.locationInputForVariable = decision.variables["location_input_for_algorithm"];
        }
        else{
            userData.sortField = "title";
        }

        getProducts(userData);
        return true;
    }

  function getUserAttributes(userData) {
    var ua = { 
        user_id: userData.uid, 
        region_state: userData.regionState,
        is_mobile_user: userData.mobileUser === true,
        is_logged_in: userData.isLoggedIn === true,
        days_since_last_order: parseInt(userData.daysSinceLastOrder)
      };

      return ua;
  }</script><h1 class="w-full mt-0 mb-2 text-5xl font-medium leading-tight text-primary"><span class="text-transparent bg-clip-text bg-gradient-to-r to-blue-600 from-sky-400 tracking-normal">Product Listing Page</span></h1><div class="container mx-auto flex flex-col justify-center items-center"><template x-teleport="#flagUserSection"><div x-data="{ user: $store.user} " x-init="intializeAttributes(user);"><div class="pb-5" x-init="$watch('user.isLoggedIn', (val) => user.updateLocalStorage('is_logged_in', val))"><label class="relative inline-flex items-center cursor-pointer"><input x-model="user.isLoggedIn" class="sr-only peer" type="checkbox" x-bind:checked="user.isLoggedIn == true" name="isLoggedInId" id="isLoggedInId"><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div><span class="ml-3 text-sm font-medium text-gray-900 dark:text-gray-300">Is Logged In</span></label></div><div class="pb-5" x-init="$watch('user.daysSinceLastOrder', (val) => user.updateLocalStorage('days_since_last_order', val))"><label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Days Since Last Order</label> <input x-model="user.daysSinceLastOrder" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" type="text" name="daysSinceLastOrderId" id="daysSinceLastOrderId"></div><div class="pb-5"><img src="/static/img/qr-codes/qr-code-plp.png"></div></div></template></div><div class="bg-white" x-data="{ user: $store.user} " x-init="intializeAttributes(user);"><div x-data="{ query: new URLSearchParams(location.search).get('sdkkey')}"><div class="mx-auto max-w-2xl px-4 py-16 sm:px-6 sm:py-24 lg:max-w-7xl lg:px-8"><h2 class="text-2xl font-bold tracking-tight text-gray-900">Womens Clothing</h2><div x-data="$store.optiSdk"><div x-data="{ userData: $store.user }"><template x-if="getPlpFlag(
                clientVersion, 
                userData,
                'plp')"><div><div class="place-self-end text-lg font-bold text-red-700" x-text="'Sorted by ' + userData.sortField"></div><div class="mt-6 grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-4 xl:gap-x-8"><template x-for="product in userData.products"><div class="group p-2"><div class="aspect-h-1 aspect-w-1 w-full overflow-hidden rounded-md bg-gray-200 lg:aspect-none group-hover:opacity-75 lg:h-120"><img :src="product.images[3]" alt="Front of men&#039;s Basic Tee in black." class="h-full w-full object-cover object-center lg:w-full"></div><div class="mt-4 flex justify-between"><div><h3 class="text-sm text-gray-700"><a x-text="product.title" :href="'/pdp?p=' + product.sku" x-model="product.sku"><span aria-hidden="true" class="absolute inset-0"></span></a></h3><p class="mt-1 text-sm text-gray-500" x-text="product.detail_bullets[0].bullet"></p></div><p class="text-sm font-medium text-gray-900" x-text="'$' + product.price"></p></div></div></template></div></div></template></div></div></div><script src="/fx-demos/static/js/alpine.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.js"></script></div></div></div></div></div></div></div></body><footer class="bottom-0 text-center w-full py-4"><small class="text-gray-500">Copyright © Feature Experimentation Demo 2020. Created by <a href="#" target="_blank" class="underline">Your Optimizely Solution Architects</a> • <a href="https://github.com/chrisvaf/fx-demos" class="underline" target="_blank" rel="noopener">View on Github</a></small></footer></html>